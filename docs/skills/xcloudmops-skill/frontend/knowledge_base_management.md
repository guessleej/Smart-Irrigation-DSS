# 知識庫管理前端開發指南

## 1. 功能概述

知識庫管理是 xCloudMOPs 的核心功能之一。前端需要提供一個直觀、高效的介面，讓使用者可以完成文件的上傳、管理、分塊策略選擇和檢索測試等一系列操作。

## 2. 介面佈局

採用主-從介面佈局：

*   **左側列表 (Master)**：顯示所有知識庫的列表。每個知識庫條目應包含名稱、文件數量、創建時間等基本資訊。
*   **右側工作區 (Detail)**：當使用者在左側選擇一個知識庫後，右側會顯示該知識庫的詳細管理介面，包含多個標籤頁。

## 3. 核心功能實現

### 3.1 文件管理標籤頁

*   **文件上傳**：提供一個支持拖拽和點擊選擇的 Ant Design `Upload` 組件。上傳時應有進度條顯示。
*   **文件列表**：使用 Ant Design `Table` 組件展示已上傳的文件。表格應包含文件名、大小、狀態（如「待處理」、「已索引」、「失敗」）、上傳時間等列。
*   **文件操作**：每行文件後應有操作按鈕，如「預覽」、「重新索引」、「刪除」。
*   **文件預覽**：點擊「預覽」按鈕，使用 `react-pdf` 或類似庫在一個 Modal 中顯示 PDF 內容。

### 3.2 設置標籤頁

此標籤頁用於配置知識庫的處理和檢索策略。

*   **分塊策略 (Chunking Strategy)**：
    *   **UI**：提供一個 Ant Design `Select` 下拉選單，選項包含所有已定義的分塊策略（`NAIVE`, `PAPER`, `BOOK`, `MANUAL`, `QA`, `LAWS`, `RESUME`, `PRESENTATION`, `TABLE`）。
    *   **互動**：當使用者選擇一個策略時，下方可以動態顯示該策略的詳細描述和可配置參數（例如，`NAIVE` 策略可以配置 `Token` 數量限制）。
    *   **API**：選擇後，點擊「保存設置」按鈕，將所選策略和參數通過 API 發送到後端。

*   **模型選擇**：
    *   **UI**：提供兩個 `Select` 組件，分別用於選擇 `Embedding 模型` 和 `Reranker 模型`。
    *   **API**：選項列表應從後端 `/api/models?type=embedding` 和 `/api/models?type=reranker` 等接口獲取。

### 3.3 檢索測試標籤頁

提供一個類似聊天機器人的介面，讓使用者可以測試當前知識庫的檢索效果。

*   **UI**：一個輸入框和一個顯示結果的區域。
*   **互動**：使用者輸入問題後，前端調用後端 `/api/knowledge_bases/{id}/search` 接口。返回的結果應包含檢索到的文本塊、來源文件、相似度分數等資訊，並清晰地展示出來。

## 4. 技術棧應用

*   **狀態管理**：使用 `TanStack Query` 來管理知識庫列表、文件列表以及模型列表的獲取。對於文件上傳狀態，可以使用 `Zustand` 創建一個 store 來進行全局管理。
*   **路由**：使用 UmiJS 的內置路由，例如 `/knowledge-bases/{id}` 來對應特定的知識庫詳情頁。
*   **組件**：大量使用 Ant Design 的 `Table`, `Select`, `Upload`, `Modal`, `Tabs` 等成熟組件來快速構建介面。
