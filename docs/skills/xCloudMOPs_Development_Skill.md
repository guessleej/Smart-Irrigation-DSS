# xCloudMOPs 開發 Skill

> **版本**: 1.1.0  
> **適用對象**: xCloudMOPs 平台前後端開發者、AI 工程師、DevOps 工程師  
> **維護單位**: 云碩科技 (xCloudinfo Group)

---

## 第一部分：系統概覽與架構

### 1.1 平台簡介

**xCloudMOPs** 是由云碩科技打造的企業級 LLMOps 平台，旨在為企業提供一站式的大型語言模型應用開發、部署與運維解決方案。平台整合了 RAG（檢索增強生成）、AI Agent、GraphRAG、工作流編排等核心能力，並支援雲地混合架構，讓企業可以靈活地在本地或雲端部署和管理 AI 應用。

平台的核心設計理念是**專業、直觀、模組化**。透過精心設計的 UI/UX 和強大的後端服務，xCloudMOPs 能夠滿足從 AI 研究人員到業務分析師的多樣化需求。

### 1.2 系統分層架構

xCloudMOPs 採用清晰的分層架構，確保各層職責分明、易於維護和擴展。

| 層級 | 名稱 | 核心職責 | 主要技術/服務 |
|:---|:---|:---|:---|
| L1 | 前端展現層 | 提供使用者介面，處理使用者交互 | UmiJS 4.0, React 18, Ant Design 5.x, ReactFlow |
| L2 | 接口服務層 | 提供 RESTful API，處理業務邏輯入口 | Flask, Nginx 反向代理 |
| L3 | 業務邏輯層 | 實現核心業務功能（RAG、Agent、工作流等） | Python, Celery |
| L4 | 深度文檔層 | 處理文檔解析、OCR、結構化提取 | Vision 模塊, Parser 解析器 |
| L5 | 模型適配層 | 透過 LiteLLM 統一管理和調用各類 LLM 模型 | LiteLLM, Xinference, Ollama, vLLM |
| L6 | 數據存儲層 | 持久化存儲各類數據 | MySQL, Redis, ES/Infinity, MinIO |
| L7 | 基礎設施層 | 提供日誌、監控、認證等基礎服務 | Grafana, Docker, Kubernetes |

### 1.3 核心技術棧

**前端技術棧**：

| 類別 | 技術選型 | 說明 |
|:---|:---|:---|
| 框架 | UmiJS 4.0 + React 18 + TypeScript | 企業級前端框架，提供完善的路由和構建能力 |
| UI 組件 | Ant Design 5.x + Radix UI + Tailwind CSS | 成熟的企業級組件庫，搭配原子化 CSS |
| 狀態管理 | Zustand + TanStack Query | 輕量級全局狀態管理 + 強大的服務端狀態管理 |
| 視覺化 | ReactFlow + Recharts | 用於 Agent/工作流畫布和數據圖表 |
| 國際化 | react-i18next | 多語言支援 |

**後端技術棧**：

| 類別 | 技術選型 | 說明 |
|:---|:---|:---|
| Web 框架 | Flask | 輕量級 Python Web 框架 |
| 任務隊列 | Celery | 分散式任務隊列，處理異步任務 |
| 反向代理 | Nginx | 負載均衡和請求路由 |
| 容器化 | Docker + Kubernetes | 標準化部署和編排 |

**數據存儲策略**：

| 存儲類型 | 技術選型 | 用途 |
|:---|:---|:---|
| 關係型資料庫 | MySQL | 元數據、使用者資訊、配置 |
| 向量資料庫 | ES/Infinity, Milvus, Chroma, Weaviate, pgvector | 文件向量和全文索引 |
| 緩存系統 | Redis | 緩存檢索結果和會話狀態 |
| 物件存儲 | MinIO/S3 | 原始文件和處理結果 |

---

## 第二部分：UI/UX 設計理念

### 2.1 核心設計原則

xCloudMOPs 的 UI/UX 設計圍繞三大核心原則展開，旨在為使用者提供專業、高效且愉悅的操作體驗。

**專業 (Professional)**：介面設計應體現企業級軟體的嚴謹性與可靠性。採用以 Ant Design 為基礎的設計語言，搭配 Tailwind CSS 進行客製化，打造一個清晰、一致且資訊密度高的介面。Recharts 將用於呈現專業、精確的數據圖表，而 Grafana 的監控面板將被無縫嵌入，提供專業級的系統監控視圖。

**直觀 (Intuitive)**：儘管平台功能複雜，但操作流程應盡可能直觀。我們將大量採用視覺化工具，如基於 ReactFlow 的拖拽式畫布，用於 Agent 和工作流的設計。使用者應能透過視覺化操作完成大部分複雜的邏輯編排，而非編寫繁瑣的程式碼。

**模組化 (Modular)**：整個平台的功能將被拆分為獨立但互聯的模組。這種模組化設計不僅體現在後端架構上，也將貫穿於前端介面。使用者可以在不同的功能模組之間無縫切換，例如從「知識庫管理」跳轉到「Agent 編輯器」，並將知識庫作為一個模組化的「節點」在 Agent 中使用。

### 2.2 整體介面佈局

為了在有限的螢幕空間內承載豐富的功能，xCloudMOPs 採用經典且高效的**三欄式佈局**。

| 區域 | 功能 | 設計要點 |
|:---|:---|:---|
| **左側導航欄 (Navigation)** | 提供對平台所有核心模組的快速訪問，如 Dashboard、知識庫、模型、Agent、工作流、監控等 | 可收縮的垂直圖標菜單，懸停時顯示文字標籤，保持工作區最大化 |
| **中間主工作區 (Workspace)** | 使用者的主要操作區域，根據所選模組呈現不同介面 | 寬敞、簡潔，是視覺焦點所在 |
| **右側配置/資訊欄 (Inspector)** | 提供對主工作區中選定元素的詳細資訊展示和參數配置 | 可根據需要顯示或隱藏，提供上下文相關的操作 |

### 2.3 品牌客製化

xCloudMOPs 支援企業品牌客製化，讓平台能夠融入企業的視覺識別系統。

**Logo 上傳規格**：

| 項目 | 建議值 |
|:---|:---|
| 尺寸 | 240 x 60 像素 |
| 格式 | SVG, PNG, JPG |
| 檔案大小 | 小於 5MB |
| 設計建議 | 使用較窄的圖片檔案，以減少標誌被裁切或不顯示的機率 |

---

## 第三部分：核心功能模組開發指南

### 3.1 知識庫管理模組

#### 3.1.1 功能概述

知識庫管理是 xCloudMOPs 的核心功能之一，負責文件的上傳、處理、索引和檢索。前端需要提供一個直觀、高效的介面，讓使用者可以完成文件的上傳、管理、分塊策略選擇和檢索測試等一系列操作。

#### 3.1.2 分塊策略選擇指南

選擇合適的分塊策略對 RAG 效果至關重要。下表提供各種文件類型的策略選擇建議：

| 文件類型 | 推薦策略 | 關鍵特點 | 適用場景 |
|:---|:---|:---|:---|
| 通用文件 | NAIVE | 通用性強，配置靈活 | 企業文檔、技術資料 |
| 學術論文 | PAPER | 結構化處理，引用保持 | 科研機構、學術平臺 |
| 電子書籍 | BOOK | 章節識別，層次分明 | 圖書館、教育平臺 |
| 操作手冊 | MANUAL | 步驟保持，圖文配對 | 技術文件、使用者指南 |
| 問答文檔 | QA | 問答完整，關聯處理 | 客服系統、FAQ |
| 法律文件 | LAWS | 條文完整，引用關係 | 法務系統、合規平臺 |
| 個人簡歷 | RESUME | 結構化提取，時間線 | HR 系統、招聘平臺 |
| 演示文稿 | PRESENTATION | 頁面獨立，視覺保持 | 培訓系統、展示平臺 |
| 表格數據 | TABLE | 表格結構保持，列標題關聯 | 財務分析、數據報表 |

#### 3.1.3 前端實現要點

知識庫管理介面採用主-從佈局，左側顯示知識庫列表，右側顯示選定知識庫的詳細管理介面。詳細管理介面應包含以下標籤頁：

**文件管理標籤頁**：提供文件上傳（支持拖拽）、文件列表展示、文件預覽和操作（重新索引、刪除）等功能。使用 Ant Design 的 `Upload`、`Table`、`Modal` 組件。

**設置標籤頁**：提供分塊策略選擇（使用 `Select` 組件，選項動態顯示策略描述）、Embedding 模型和 Reranker 模型選擇。

**檢索測試標籤頁**：提供類似聊天機器人的介面，讓使用者測試檢索效果，顯示檢索到的文本塊、來源文件和相似度分數。

#### 3.1.4 後端 API 設計

| 端點 | 方法 | 功能 |
|:---|:---|:---|
| `/api/v1/knowledge_bases` | GET | 獲取知識庫列表 |
| `/api/v1/knowledge_bases` | POST | 創建新知識庫 |
| `/api/v1/knowledge_bases/{id}` | GET | 獲取知識庫詳情 |
| `/api/v1/knowledge_bases/{id}` | PUT | 更新知識庫設置 |
| `/api/v1/knowledge_bases/{id}/documents` | POST | 上傳文件 |
| `/api/v1/knowledge_bases/{id}/documents/{doc_id}` | DELETE | 刪除文件 |
| `/api/v1/knowledge_bases/{id}/search` | POST | 執行檢索測試 |

### 3.2 RAG 核心服務

#### 3.2.1 服務職責

RAG 核心服務是 xCloudMOPs 的心臟，負責將用戶的查詢與知識庫中的信息相結合，生成高質量的回覆。它的核心職責包括：接收來自接口服務層的請求，執行複雜的檢索與生成流程，並返回最終結果。

#### 3.2.2 內部工作流

RAG 服務收到搜索請求後，將按順序執行以下工作流：

1. **查詢理解**：對用戶的查詢進行分析，判斷其意圖，可能會進行查詢擴展或重寫。

2. **向量檢索引擎**：根據知識庫 ID 確定目標向量數據庫，使用 Embedding 模型將查詢轉換為向量，執行相似性搜索召回候選文檔塊。

3. **混合搜索策略**：結合向量檢索和全文檢索（如 BM25）來召回更多樣化的結果，並進行結果合併。

4. **召回與重排序**：將合併後的結果傳遞給 Reranker 模型進行重新打分，篩選出最相關的 top-k 個結果。

5. **上下文融合**：將經過重排序的文檔塊與對話歷史和原始查詢融合，構建內容豐富的 Prompt。

6. **生成**：將 Prompt 發送給對話模型，接收生成的最終答案。

7. **返回結果**：將最終答案和引用的來源文檔等信息返回給調用方。

### 3.3 Agent 層開發

#### 3.3.1 視覺化畫布設計器

Agent 的創建和編輯採用基於 ReactFlow 的視覺化畫布設計器，摒棄傳統的表單配置方式。

**畫布 (Canvas)**：使用者可以在無限畫布上，透過拖拽來放置和連接不同的功能「節點」，構建 Agent 的執行邏輯。

**節點 (Nodes)**：每個節點代表一個原子操作，例如「從知識庫檢索」、「呼叫外部 API」、「執行 Python 程式碼」、「生成回覆」等。節點以卡片形式呈現，清晰標示其功能和狀態。

**組件庫 (Component Library)**：畫布左側提供「組件庫」，使用者可以從中拖出預設的或自定義的節點到畫布上。

**狀態管理**：在運行和除錯模式下，節點邊框以不同顏色顯示執行狀態（綠色=成功，紅色=失敗，黃色=進行中），數據流在連接線上有動態效果。

#### 3.3.2 Agent 層核心組件

| 組件 | 功能 | 實現要點 |
|:---|:---|:---|
| 畫布設計器 | 視覺化編排 Agent 邏輯 | 基於 ReactFlow，支持縮放、平移、節點拖拽 |
| 組件庫管理 | 管理可用的節點類型 | 支持自定義節點，節點分類展示 |
| 工作流引擎 | 執行 Agent 邏輯 | 支持順序、並行、條件分支執行 |
| 狀態管理 | 追蹤 Agent 執行狀態 | 即時更新節點狀態，支持斷點調試 |

### 3.4 GraphRAG 層開發

#### 3.4.1 知識圖譜探索器

GraphRAG 層提供知識圖譜的構建和探索能力，讓使用者能夠理解和利用實體之間的關係進行更複雜的推理。

**圖譜構建**：提供引導式流程，讓使用者上傳非結構化數據，系統在後端進行實體關係抽取和知識圖譜構建。UI 上顯示處理進度，完成後通知使用者。

**視覺化探索**：構建完成的圖譜在交互式圖形介面中展示。使用者可以縮放、拖動、搜索特定節點，查看節點之間的關係。點擊節點時，右側配置欄顯示詳細屬性和關聯資訊。

**圖推理搜索**：提供自然語言輸入框，使用者可以提出複雜問題。系統執行圖推理搜索和多跳推理，在圖譜上高亮顯示相關路徑和節點，將推理過程視覺化。

#### 3.4.2 GraphRAG 核心組件

| 組件 | 功能 |
|:---|:---|
| 知識圖譜構建 | 從非結構化數據中提取實體和關係 |
| 實體關係抽取 | 識別文本中的實體及其關係 |
| 圖推理搜索 | 基於圖結構進行語義搜索 |
| 多跳推理 | 支持跨越多個節點的複雜推理 |

### 3.5 工作流編排層開發

#### 3.5.1 企業級流程編排器

工作流編排層面向更複雜的、跨越多個服務的自動化任務，是 Agent 設計器的擴展和升級版。

**統一介面**：與 Agent 設計器共享相似的視覺化畫布 UI，但提供更強大的控制邏輯節點。

**高級節點**：除了 Agent 的基礎節點外，還提供「條件分支 (If/Else)」、「並行處理 (Parallel)」、「錯誤處理 (Try/Catch)」、「定時觸發」等高級流程控制節點。

**流程監控與恢復**：在 Dashboard 或專門的監控頁面，使用者可以查看每個工作流的執行歷史、狀態和日誌。對於失敗的任務，UI 上提供「重試」或「從失敗步驟恢復」的選項。

#### 3.5.2 工作流核心組件

| 組件 | 功能 |
|:---|:---|
| 任務調度引擎 | 管理任務的排程和執行 |
| 流程編排器 | 定義和管理工作流程 |
| 條件分支邏輯 | 支持 If/Else、Switch 等條件控制 |
| 錯誤處理恢復 | 異常捕獲、重試機制、斷點恢復 |

---

## 第四部分：模型管理與適配

### 4.1 支援的 LLM 服務

xCloudMOPs 透過 **LiteLLM** 統一管理所有對外 LLM API，支援超過 100 種模型，實現無縫的雲地混合架構：

| 服務類型 | 支援的服務 | 部署方式 |
|:---|:---|:---|
| 本地推理 | llama.cpp, Ollama, Xinference | 地端部署 |
| 高性能推理 | vLLM, SGLang | 地端/雲端 |
| 雲端服務 | OpenAI, Claude, Gemini, Qwen | 雲端 API |

### 4.2 LiteLLM 統一 API 管理

xCloudMOPs 採用 **LiteLLM** 作為所有對外 LLM API 的統一管理層。所有對模型的調用，無論是本地部署還是雲端服務，都應通過 LiteLLM 提供的 OpenAI 標準兼容接口進行。這帶來了以下好處：

*   **統一接口**：開發者只需編寫一次代碼，即可調用超過 100 種不同的 LLM。
*   **負載均衡與故障轉移**：可配置多個模型密鑰，實現自動的負載均衡和故障轉移。
*   **成本控制與日誌**：集中管理 API 密鑰，監控和記錄所有模型的調用成本和日誌。

### 4.3 模型適配層設計

模型適配層提供統一的接口來調用不同的 LLM 服務，解耦業務邏輯和具體的模型實現。

**支援的模型類型**：

| 模型類型 | 用途 | 示例 |
|:---|:---|:---|
| 對話模型 | 生成回覆、對話交互 | Qwen 2.5 Max, GPT-4, Claude |
| 嵌入模型 | 文本向量化 | text-embedding-3, BGE |
| 重排序模型 | 檢索結果重排 | BGE-Reranker, Cohere Rerank |
| 多模態模型 | 圖像理解、視覺問答 | Gemini Vision, Qwen-VL |

### 4.3 模型微調功能

xCloudMOPs 支援類似 Dify 的模型微調功能，讓使用者可以基於自己的數據微調開源模型。

**微調工作流**：

1. **數據準備**：上傳訓練數據，支持多種格式（JSONL、CSV 等）
2. **模型選擇**：選擇基礎模型（如 Llama、Qwen 等開源模型）
3. **參數配置**：設置學習率、訓練輪數、批次大小等超參數
4. **訓練監控**：即時查看訓練進度、損失曲線等指標
5. **模型評估**：使用測試集評估微調後的模型效果
6. **模型部署**：將微調後的模型部署到推理服務

---

## 第五部分：實際應用場景

### 5.1 企業知識庫

**文檔管理**：統一管理企業內部文檔，支持多種文件格式和分塊策略。

**智慧問答**：員工可以透過自然語言快速查找相關信息，系統自動從知識庫中檢索並生成回答。

**知識沉澱**：將專家經驗轉化為可檢索的知識，實現知識的傳承和共享。

### 5.2 客服系統

**問題分類**：自動識別使用者問題類型，路由到相應的處理流程。

**答案推薦**：基於歷史對話和知識庫推薦解決方案。

**工單處理**：智慧分析工單內容並推薦處理方式，提升客服效率。

### 5.3 法律諮詢

**案例檢索**：基於案例相似度檢索相關判例，使用 LAWS 分塊策略保持條文完整性。

**法條匹配**：自動匹配相關法律條文，支持引用關係追蹤。

**風險評估**：分析案件風險和勝訴概率，提供決策支持。

### 5.4 個人 Open NotebookLM

xCloudMOPs 支援創建個人的 Open NotebookLM，讓使用者可以：

**建立個人知識庫**：上傳個人文檔、筆記、研究資料等，建立專屬的知識庫。

**智慧對話**：與個人知識庫進行對話，快速獲取所需信息。

**TTS/Vision 支援**：支援雲端與地端的 TTS 模型和 Vision 模型，實現語音交互和圖像理解。

---

## 第六部分：Artifacts 與程式碼生成

### 6.1 OpenCode 整合

xCloudMOPs 整合 OpenCode 功能，支援 Artifacts 能力：

**HTML/CSS/JavaScript 渲染**：支援即時渲染 HTML、CSS、JavaScript 代碼，提供即時預覽。

**外部函式庫引入**：可以引入外部的 JavaScript 函式庫（如 D3.js、Chart.js 等）。

**SVG 生成與預覽**：透過文字描述，要求語言模型生成 SVG 並即時預覽。

### 6.2 程式碼編輯器功能

| 功能 | 說明 |
|:---|:---|
| 語法高亮 | 支援多種程式語言的語法高亮 |
| 即時預覽 | HTML/CSS/JS/SVG 即時渲染預覽 |
| 程式碼補全 | AI 輔助的程式碼補全 |
| 錯誤檢查 | 即時語法錯誤檢查 |
| 版本控制 | 程式碼版本歷史追蹤 |

---

## 第七部分：監控與運維

### 7.1 Dashboard 設計

登入後的 Dashboard 應顯示所有工作並監控所有服務，包含：

**系統概覽**：顯示系統整體健康狀態、活躍使用者數、請求量等關鍵指標。

**服務狀態**：顯示各微服務的運行狀態、響應時間、錯誤率等。

**硬體資源監控**：CPU、記憶體、磁碟、網路等資源使用情況。

**任務監控**：顯示正在執行的任務、排隊中的任務、已完成的任務等。

### 7.2 Grafana 整合

xCloudMOPs 使用 Grafana 作為底層服務監控整體環境架構：

**預設儀表板**：系統預設安裝並配置好 Grafana，提供開箱即用的監控儀表板。

**自定義儀表板**：使用者可以根據需求自定義監控儀表板。

**告警配置**：支援配置告警規則，當指標異常時自動通知。

---

## 第八部分：部署指南

### 8.1 Docker Compose 部署

xCloudMOPs 使用 Docker Compose 進行部署，確保系統可以在任何環境中快速部署。

**預設安裝的服務**：

| 服務類別 | 服務名稱 |
|:---|:---|
| 向量資料庫 | PostgreSQL (pgvector), MongoDB Atlas, Milvus, Chroma, Elasticsearch |
| 緩存 | Redis |
| 物件存儲 | MinIO |
| 監控 | Grafana, Prometheus |
| LLM 推理 | Ollama |
| API 管理 | LiteLLM |

### 8.2 部署步驟

1. **環境準備**：確保安裝 Docker 和 Docker Compose
2. **配置文件**：根據環境修改 `.env` 配置文件
3. **啟動服務**：執行 `docker-compose up -d`
4. **驗證部署**：訪問各服務端點確認正常運行
5. **初始化**：執行初始化腳本創建預設用戶和配置

---

## 第九部分：測試與除錯

### 9.1 測試策略

| 測試類型 | 工具 | 覆蓋範圍 |
|:---|:---|:---|
| 單元測試 | Jest, pytest | 組件、函數級別 |
| 整合測試 | Cypress, pytest | API、服務間交互 |
| 端到端測試 | Playwright | 完整用戶流程 |
| 性能測試 | k6, Locust | 負載、壓力測試 |

### 9.2 除錯指南

**前端除錯**：使用 React DevTools 和瀏覽器開發者工具，檢查組件狀態和網路請求。

**後端除錯**：查看服務日誌，使用斷點調試，檢查 API 響應。

**RAG 除錯**：檢查檢索結果、Prompt 構建、模型響應等各環節。

---

## 附錄：快速參考

### API 端點總覽

| 模組 | 端點前綴 | 說明 |
|:---|:---|:---|
| 知識庫 | `/api/v1/knowledge_bases` | 知識庫 CRUD 和檢索 |
| 模型 | `/api/v1/models` | 模型管理和調用 |
| Agent | `/api/v1/agents` | Agent 管理和執行 |
| 工作流 | `/api/v1/workflows` | 工作流管理和執行 |
| 對話 | `/api/v1/conversations` | 對話管理 |
| 用戶 | `/api/v1/users` | 用戶管理 |

### 環境變數配置

| 變數名 | 說明 | 預設值 |
|:---|:---|:---|
| `DATABASE_URL` | MySQL 連接字串 | - |
| `REDIS_URL` | Redis 連接字串 | - |
| `VECTOR_DB_TYPE` | 向量資料庫類型 | elasticsearch |
| `MINIO_ENDPOINT` | MinIO 端點 | - |
| `LLM_PROVIDER` | 預設 LLM 提供商 | ollama |

---

> **文件維護**: 本 Skill 文件由云碩科技 AI 團隊維護，如有問題請聯繫 service@cloudinfo.com.tw
